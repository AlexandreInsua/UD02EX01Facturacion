
/* Incrementar prezo (procedemento) */ 
	pendente


/* Listado productos */ 
SELECT * FROM productos;

/* Listado produtos mínimo */
SELECT * FROM productos WHERE pdStock < pdStockMinimo;

/* Listado beneficios */
SELECT 
    productos.pdNombre, pdPrecioCompra, pdPrecioVenta, liCantidad, (pdPrecioVenta - pdPrecioCompra) * liCantidad AS 'Beneficio',
    prNombre, prTelefono, prWeb
FROM
    ((productos
    JOIN proveedores ON pdNifProveedor = prNif)
    JOIN lineaspedido ON pdId = liIdProducto)
        JOIN
    pedidos ON liNumPedido = peNumPedido
GROUP BY liIdProducto;

/* Valoración Existencias */ 
	# lista
SELECT pdNombre, pdStock, pdPrecioCompra, (pdStock*pdPrecioCompra) as 'Valoración' FROM productos;
	# total
SELECT pdNombre, pdStock, pdPrecioCompra, sum(pdStock*pdPrecioCompra) as 'Total' FROM productos;

/* Consultar pedido */
SELECT 
    peNumPedido, peFecha, clNombre, peDescuento, liNumPedido, pdNombre, pdPrecioVenta, liCantidad,
    (pdPrecioVenta * liCantidad) AS 'Importe'
FROM
    ((pedidos
    JOIN clientes ON peNifCliente = clNif)
    JOIN lineaspedido ON peNumPedido = liNumPedido)
        JOIN
    productos ON liIdProducto = pdid
WHERE
    peNumPedido = 1; # número de pedido do combo
    
/* Consultar Factura */
# datos
SELECT 
    peNumPedido, peFecha, peDescuento, clNombre, clCalle, clCodPostal, clCiudad, liNumPedido,
    pdNombre,  pdPrecioVenta, liCantidad,  (pdPrecioVenta * liCantidad) AS 'Importe'
FROM
    ((pedidos
    JOIN clientes ON peNifCliente = clNif)
    JOIN lineaspedido ON peNumPedido = liNumPedido)
        JOIN
    productos ON liIdProducto = pdid
WHERE
    peNumPedido = 1; # número de pedido do combo
    
# cálculos
SELECT 
    SUM(pdPrecioVenta * liCantidad) AS 'Subtotal',
    FORMAT(SUM(pdPrecioVenta * liCantidad) * IFNULL(peDescuento, 0) / 100,
        2) AS 'Descuento',
    FORMAT(SUM(pdPrecioVenta * liCantidad) - SUM(pdPrecioVenta * liCantidad) * IFNULL(peDescuento, 0) / 100,
        2) AS 'Base Imponible',
    pdIva,
    FORMAT((SUM(pdPrecioVenta * liCantidad) - SUM(pdPrecioVenta * liCantidad) * IFNULL(peDescuento, 0) / 100) * (21 / 100),
        2) AS 'IVA',
    FORMAT((SUM(pdPrecioVenta * liCantidad) - SUM(pdPrecioVenta * liCantidad) * IFNULL(peDescuento, 0) / 100) 
    + (SUM(pdPrecioVenta * liCantidad) - SUM(pdPrecioVenta * liCantidad) * IFNULL(peDescuento, 0) / 100) * (21 / 100),
        2) AS 'Total'
FROM
    ((pedidos
    JOIN clientes ON peNifCliente = clNif)
    JOIN lineaspedido ON peNumPedido = liNumPedido)
        JOIN
    productos ON liIdProducto = pdid
WHERE
    peNumPedido = 2 ; # número de pedido do combo
     


    
 /* Consultar Factura mes*/
SELECT 
    peNumPedido, peFecha, peDescuento, clNombre, clCalle, clCodPostal, clCiudad, liNumPedido,
    pdNombre,  pdPrecioVenta, liCantidad,  (pdPrecioVenta * liCantidad) AS 'Importe'
FROM
    ((pedidos
    JOIN clientes ON peNifCliente = clNif)
    JOIN lineaspedido ON peNumPedido = liNumPedido)
        JOIN
    productos ON liIdProducto = pdid
WHERE
    month(peFecha)= 10; # fecha en combo
    
/* Consultar Factura cliente*/
SELECT 
    peNumPedido, peFecha, peDescuento, clNombre, clCalle, clCodPostal, clCiudad, liNumPedido,
    pdNombre,  pdPrecioVenta, liCantidad,  (pdPrecioVenta * liCantidad) AS 'Importe'
FROM
    ((pedidos
    JOIN clientes ON peNifCliente = clNif)
    JOIN lineaspedido ON peNumPedido = liNumPedido)
        JOIN
    productos ON liIdProducto = pdid
WHERE
    clNombre = 'Andrés García'; # cliente do combo

